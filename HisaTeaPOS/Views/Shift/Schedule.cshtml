@model IEnumerable<HisaTeaPOS.Models.LichLamViec>
@{
    ViewBag.Title = "Xếp Ca Làm Việc";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var staffList = ViewBag.StaffList as List<HisaTeaPOS.Models.NhanVien>;
}

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 animate-in fade-in duration-300">

    <div class="bg-white rounded-xl shadow-sm border p-5 h-fit">
        <h3 class="font-bold text-lg mb-4 text-gray-800 flex items-center gap-2">
            <i data-lucide="calendar-plus" class="w-5 h-5 text-orange-600"></i>
            Đăng ký ca làm
        </h3>

        <form action="@Url.Action("AddSchedule", "Shift")" method="post" class="space-y-4">

            <div>
                <label class="text-xs font-bold text-gray-500 uppercase block mb-1">Ngày làm việc</label>
                <input type="date" name="ngayLam" required
                       value="@DateTime.Now.ToString("yyyy-MM-dd")"
                       class="w-full px-3 py-2 border rounded-lg bg-gray-50 focus:border-orange-500 outline-none" />
            </div>

            <div>
                <label class="text-xs font-bold text-gray-500 uppercase block mb-1">Ca làm</label>
                <select name="caLam" class="w-full px-3 py-2 border rounded-lg bg-white focus:border-orange-500 outline-none">
                    <option value="Sáng (6h-14h)">Sáng (6h-14h)</option>
                    <option value="Chiều (14h-22h)">Chiều (14h-22h)</option>
                    <option value="Tối (18h-23h)">Tối (18h-23h)</option>
                    <option value="Full-time">Full-time</option>
                </select>
            </div>

            <div>
                <label class="text-xs font-bold text-gray-500 uppercase block mb-1">Nhân viên</label>
                <select name="maNV" class="w-full px-3 py-2 border rounded-lg bg-white focus:border-orange-500 outline-none">
                    @if (staffList != null)
                    {
                        foreach (var emp in staffList)
                        {
                            <option value="@emp.MaNV">@emp.HoTen</option>
                        }
                    }
                </select>
            </div>

            <button type="submit" class="w-full py-2.5 bg-orange-600 hover:bg-orange-700 text-white font-bold rounded-lg shadow-md transition-colors">
                Thêm vào lịch
            </button>
        </form>
    </div>

    <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border p-5">
        <h3 class="font-bold text-lg mb-4 text-gray-800 flex items-center gap-2">
            <i data-lucide="calendar" class="w-5 h-5 text-blue-600"></i>
            Lịch làm việc sắp tới
        </h3>

        <div class="space-y-3">
            @if (!Model.Any())
            {
                <p class="text-gray-400 italic text-center py-8">Chưa có lịch làm việc nào được xếp.</p>
            }
            else
            {
                // Nhóm theo ngày để hiển thị đẹp hơn
                var groupedSchedules = Model.GroupBy(x => x.NgayLam).OrderByDescending(g => g.Key);

                foreach (var group in groupedSchedules)
                {
                    <div class="border rounded-xl overflow-hidden">
                        <div class="bg-gray-100 px-4 py-2 border-b flex justify-between items-center">
                            <span class="font-bold text-gray-700">
                                @group.Key.ToString("dd/MM/yyyy") - @group.Key.ToString("dddd", new System.Globalization.CultureInfo("vi-VN"))
                            </span>
                            <span class="text-xs bg-white border px-2 py-0.5 rounded text-gray-500">@group.Count() ca</span>
                        </div>

                        <div class="divide-y divide-gray-100">
                            @foreach (var item in group)
                            {
                                <div class="p-3 flex justify-between items-center hover:bg-gray-50">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 rounded-full flex items-center justify-center
                                            @(item.CaLam.Contains("Sáng") ? "bg-yellow-100 text-yellow-600" :
                                              item.CaLam.Contains("Chiều") ? "bg-orange-100 text-orange-600" : "bg-purple-100 text-purple-600")">
                                            @if (item.CaLam.Contains("Sáng"))
                                            {<i data-lucide="sun" class="w-5 h-5"></i> }
                                            else if (item.CaLam.Contains("Chiều"))
                                            { <i data-lucide="sunset" class="w-5 h-5"></i> }
                                            else
                                            { <i data-lucide="moon" class="w-5 h-5"></i>}
                                        </div>

                                        <div>
                                            <div class="font-bold text-gray-800">@item.NhanVien.HoTen</div>
                                            <div class="text-xs text-gray-500">@item.CaLam</div>
                                        </div>
                                    </div>

                                    <a href="@Url.Action("DeleteSchedule", "Shift", new { id = item.MaLich })"
                                       onclick="return confirm('Xóa lịch làm này?')"
                                       class="text-red-400 hover:text-red-600 p-2 rounded-full hover:bg-red-50 transition-colors">
                                        <i data-lucide="x" class="w-4 h-4"></i>
                                    </a>
                                </div>
                            }
                        </div>
                    </div>
                }
            }
        </div>
    </div>
</div>

@section scripts {
    <script>
        lucide.createIcons();
    </script>
}