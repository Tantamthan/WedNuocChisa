@model IEnumerable<HisaTeaPOS.Models.DonHang>
@{
    ViewBag.Title = "Báo Cáo Doanh Thu";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="space-y-6 animate-in fade-in duration-300">
    <div class="bg-white rounded-xl shadow-sm border p-5">
        <div class="flex flex-col md:flex-row justify-between items-center gap-4">
            <h3 class="font-bold text-xl text-gray-800 flex items-center gap-2">
                <i data-lucide="trending-up" class="w-5 h-5 text-orange-600"></i>
                Báo cáo doanh thu
            </h3>

            <form action="@Url.Action("Index", "Report")" method="get" class="flex gap-2 bg-gray-50 p-1.5 rounded-lg border border-gray-200">
                <div class="flex items-center gap-2 px-2">
                    <span class="text-xs font-bold text-gray-500">Từ:</span>
                    <input type="date" name="startDate" value="@ViewBag.StartDate" class="bg-white border rounded px-2 py-1 text-sm outline-none focus:border-orange-500 shadow-sm" />
                </div>
                <div class="flex items-center gap-2 px-2 border-l border-gray-300">
                    <span class="text-xs font-bold text-gray-500">Đến:</span>
                    <input type="date" name="endDate" value="@ViewBag.EndDate" class="bg-white border rounded px-2 py-1 text-sm outline-none focus:border-orange-500 shadow-sm" />
                </div>
                <button type="submit" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-1 rounded text-sm font-bold transition-colors flex items-center gap-1">
                    <i data-lucide="search" class="w-3 h-3"></i> Xem
                </button>
            </form>
        </div>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-xl border border-green-200">
            <div class="text-green-600 text-xs font-bold uppercase tracking-wider mb-1">Tổng Doanh thu</div>
            <div class="text-2xl font-bold text-green-700">@string.Format("{0:N0}đ", ViewBag.TotalRevenue)</div>
        </div>

        <div class="p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl border border-blue-200">
            <div class="text-blue-600 text-xs font-bold uppercase tracking-wider mb-1">Tổng Đơn hàng</div>
            <div class="text-2xl font-bold text-blue-700">@ViewBag.TotalOrders</div>
        </div>

        <div class="p-4 bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-xl border border-emerald-200">
            <div class="text-emerald-600 text-xs font-bold uppercase tracking-wider mb-1 flex items-center gap-1">
                <i data-lucide="banknote" class="w-3 h-3"></i> Tiền mặt
            </div>
            <div class="text-xl font-bold text-emerald-700">@string.Format("{0:N0}đ", ViewBag.CashTotal)</div>
        </div>

        <div class="p-4 bg-gradient-to-br from-indigo-50 to-indigo-100 rounded-xl border border-indigo-200">
            <div class="text-indigo-600 text-xs font-bold uppercase tracking-wider mb-1 flex items-center gap-1">
                <i data-lucide="credit-card" class="w-3 h-3"></i> Chuyển khoản
            </div>
            <div class="text-xl font-bold text-indigo-700">@string.Format("{0:N0}đ", ViewBag.TransferTotal)</div>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
        <div class="bg-gray-50 p-3 border-b font-bold text-gray-700 text-sm flex justify-between items-center">
            <span>Chi tiết đơn hàng</span>
            <span class="text-xs font-normal text-gray-500">Hiển thị @Model.Count() kết quả</span>
        </div>

        <div class="overflow-x-auto">
            <table class="w-full text-sm text-left">
                <thead class="bg-white text-gray-500 font-medium border-b">
                    <tr>
                        <th class="p-3">Mã đơn</th>
                        <th class="p-3">Thời gian</th>
                        <th class="p-3">Thu ngân</th>
                        <th class="p-3 text-center">PTTT</th>
                        <th class="p-3 text-right">Tổng tiền</th>
                        <th class="p-3 text-center">Hành động</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    @if (!Model.Any())
                    {
                        <tr>
                            <td colspan="6" class="p-8 text-center text-gray-400 italic">
                                Không có đơn hàng nào trong thời gian này
                            </td>
                        </tr>
                    }
                    else
                    {
                        foreach (var item in Model.OrderByDescending(x => x.NgayTao))
                        {
                            <tr class="hover:bg-gray-50 transition-colors">
                                <td class="p-3 font-medium text-gray-700">#@item.MaDon.ToString("D4")</td>
                                <td class="p-3 text-gray-500">
                                    @item.NgayTao.Value.ToString("dd/MM/yyyy HH:mm")
                                </td>
                                <td class="p-3 text-gray-600">
                                    @(item.NhanVien?.HoTen ?? "Admin")
                                </td>
                                <td class="p-3 text-center">
                                    @if (item.HinhThucTT == "cash")
                                    {
                                        <span class="px-2 py-1 rounded text-xs font-bold bg-green-100 text-green-700 border border-green-200">Tiền mặt</span>
                                    }
                                    else
                                    {
                                        <span class="px-2 py-1 rounded text-xs font-bold bg-blue-100 text-blue-700 border border-blue-200">CK</span>
                                    }
                                </td>
                                <td class="p-3 text-right font-bold text-gray-800">
                                    @string.Format("{0:N0}đ", item.TongTien)
                                </td>
                                <td class="p-3 text-center">
                                    <button onclick="printInvoice(@item.MaDon)" class="text-blue-500 hover:text-blue-700 p-1.5 rounded-md hover:bg-blue-50 transition-colors" title="Xem chi tiết">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                    </button>
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section scripts {
    <script>
        // Kích hoạt Icon
        lucide.createIcons();

        // Hàm mở popup in hóa đơn (Sử dụng InvoiceController đã tạo trước đó)
        function printInvoice(id) {
            const url = '@Url.Action("Print", "Invoice")/' + id;
            window.open(url, 'InvoicePopup', 'width=400,height=600,scrollbars=yes,resizable=yes');
        }
    </script>
}