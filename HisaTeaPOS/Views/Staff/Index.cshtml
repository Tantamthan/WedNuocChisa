@model IEnumerable<HisaTeaPOS.Models.NhanVien>
@{
    ViewBag.Title = "Quản lý Nhân sự";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="space-y-6 animate-in fade-in duration-300">
    <div class="bg-white rounded-xl shadow-sm border p-5 flex justify-between items-center">
        <h3 class="font-bold text-xl text-gray-800 flex items-center gap-2">
            <i data-lucide="users" class="w-5 h-5 text-orange-600"></i>
            Quản lý Nhân viên
        </h3>
        <button onclick="openModal(0)" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-bold text-sm flex items-center gap-2 shadow-md transition-colors">
            <i data-lucide="user-plus" class="w-4 h-4"></i> Thêm nhân viên
        </button>
    </div>

    <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
        <table class="w-full text-sm text-left">
            <thead class="bg-gray-50 text-gray-600 font-bold uppercase text-xs border-b">
                <tr>
                    <th class="p-4">Họ tên</th>
                    <th class="p-4">Tài khoản</th>
                    <th class="p-4">Vai trò</th>
                    <th class="p-4 text-right">Lương/Giờ</th>
                    <th class="p-4 text-center">Hành động</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                @foreach (var item in Model)
                {
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="p-4 font-bold text-gray-800">@item.HoTen</td>
                        <td class="p-4 text-gray-600">@item.TaiKhoan</td>
                        <td class="p-4">
                            <span class="px-2 py-1 rounded text-xs font-bold @(item.VaiTro == "Quản lý" ? "bg-purple-100 text-purple-700" : "bg-blue-100 text-blue-700")">
                                @item.VaiTro
                            </span>
                        </td>
                        <td class="p-4 text-right font-medium text-green-600">
                            @string.Format("{0:N0}đ", item.LuongGio)
                        </td>
                        <td class="p-4 text-center">
                            <div class="flex justify-center gap-2">
                                <button onclick="openModal(@item.MaNV, '@item.HoTen', '@item.TaiKhoan', '@item.VaiTro', @item.LuongGio)"
                                        class="p-1.5 text-blue-500 hover:bg-blue-50 rounded-lg transition-colors" title="Sửa">
                                    <i data-lucide="edit-2" class="w-4 h-4"></i>
                                </button>

                                <a href="@Url.Action("Delete", "Staff", new { id = item.MaNV })"
                                   onclick="return confirm('Bạn chắc chắn muốn xóa nhân viên này?');"
                                   class="p-1.5 text-red-500 hover:bg-red-50 rounded-lg transition-colors" title="Xóa">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<div id="staffModal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeModal()"></div>
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl shadow-2xl w-full max-w-md p-6 animate-in fade-in zoom-in duration-200">
        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i data-lucide="user-cog" class="w-5 h-5 text-orange-600"></i>
            <span id="modal-title">Thêm nhân viên</span>
        </h3>

        <form action="@Url.Action("Save", "Staff")" method="post" class="space-y-4">
            <input type="hidden" id="emp-id" name="MaNV" value="0" />

            <div>
                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Họ tên</label>
                <input type="text" id="emp-name" name="HoTen" required class="w-full px-3 py-2 border rounded-lg focus:border-orange-500 outline-none" placeholder="VD: Nguyễn Văn A" />
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Tài khoản</label>
                    <input type="text" id="emp-username" name="TaiKhoan" required class="w-full px-3 py-2 border rounded-lg focus:border-orange-500 outline-none" />
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Mật khẩu</label>
                    <input type="text" id="emp-password" name="MatKhau" class="w-full px-3 py-2 border rounded-lg focus:border-orange-500 outline-none" placeholder="Để trống nếu không đổi" />
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Vai trò</label>
                    <select id="emp-role" name="VaiTro" class="w-full px-3 py-2 border rounded-lg bg-white">
                        <option value="Nhân viên">Nhân viên</option>
                        <option value="Quản lý">Quản lý</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Lương/Giờ</label>
                    <input type="number" id="emp-rate" name="LuongGio" required class="w-full px-3 py-2 border rounded-lg" value="20000" />
                </div>
            </div>

            <div class="flex gap-3 pt-2">
                <button type="button" onclick="closeModal()" class="flex-1 py-2 bg-gray-100 text-gray-700 font-bold rounded-lg hover:bg-gray-200">Hủy</button>
                <button type="submit" class="flex-1 py-2 bg-orange-600 text-white font-bold rounded-lg hover:bg-orange-700 shadow-lg">Lưu lại</button>
            </div>
        </form>
    </div>
</div>

@section scripts {
    <script>
        lucide.createIcons();

        function openModal(id, name, username, role, rate) {
            if (id === 0) {
                // Chế độ THÊM MỚI: Reset form
                document.getElementById('modal-title').innerText = "Thêm nhân viên mới";
                document.getElementById('emp-id').value = 0;
                document.getElementById('emp-name').value = "";
                document.getElementById('emp-username').value = "";
                document.getElementById('emp-username').readOnly = false; // Cho phép nhập user
                document.getElementById('emp-password').placeholder = "Nhập mật khẩu...";
                document.getElementById('emp-password').required = true;  // Bắt buộc nhập pass
                document.getElementById('emp-role').value = "Nhân viên";
                document.getElementById('emp-rate').value = 20000;
            } else {
                // Chế độ CHỈNH SỬA: Điền dữ liệu cũ
                document.getElementById('modal-title').innerText = "Cập nhật nhân viên";
                document.getElementById('emp-id').value = id;
                document.getElementById('emp-name').value = name;
                document.getElementById('emp-username').value = username;
                document.getElementById('emp-username').readOnly = true; // Không cho sửa user
                document.getElementById('emp-password').placeholder = "Để trống nếu giữ nguyên";
                document.getElementById('emp-password').required = false;
                document.getElementById('emp-role').value = role;
                document.getElementById('emp-rate').value = rate;
            }

            document.getElementById('staffModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('staffModal').classList.add('hidden');
        }
    </script>
}